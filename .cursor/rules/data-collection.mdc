---
description: Data collection workflow and implementation guidelines
globs: **/api/**/*,**/functions/**/*,**/*crawl*,**/*collect*
---

# ğŸ”„ Data Collection Workflow

## ğŸ“‹ Overview

Based on [doc/devguide.mdc](mdc:doc/devguide.mdc), this project implements a **Content Collection System** that fetches articles from external RSS sources and stores them in Supabase with deduplication. The system is currently configured for collecting content related to specific topics (e.g., entertainment, news) from various RSS feeds.

### ğŸ¯ Current Implementation Status (2025-01-12 ë¦¬íŒ©í† ë§ ì™„ë£Œ)
- âœ… **ë‚˜ëŠ”ì†”ë¡œ ì „ìš© UI**: [app/page.tsx](mdc:app/page.tsx) ì™„ì „ í•œêµ­ì–´í™”, ë‚˜ëŠ”ì†”ë¡œ ë¸Œëœë”© ì ìš©
- âœ… **API Proxy Layer**: [app/api/crawl/manual/route.ts](mdc:app/api/crawl/manual/route.ts) ê°„ì†Œí™” ë° ìµœì í™” ì™„ë£Œ
- âœ… **Edge Function v12**: [supabase/functions/crawl_manual/index.ts](mdc:supabase/functions/crawl_manual/index.ts) ì™„ì „ ë¦¬íŒ©í† ë§
  - ì½”ë“œ 35% ê°ì†Œ (438ì¤„ â†’ 286ì¤„)
  - ë„¤ì´ë²„ ë‰´ìŠ¤ HTML êµ¬ì¡° ê¸°ë°˜ ìŠ¤í¬ë˜í•‘ ìµœì í™”
  - íƒ€ì… ì•ˆì „ì„± ê°•í™” ë° í•¨ìˆ˜ ëª¨ë“ˆí™”
- âœ… **Database Schema**: [database-setup.sql](mdc:database-setup.sql) ë‚˜ëŠ”ì†”ë¡œ ì „ìš©ìœ¼ë¡œ ì •ë¦¬
- âœ… **MCP Integration**: Direct Supabase management via MCP tools
- âœ… **ë„¤ì´ë²„ ë‰´ìŠ¤ ìŠ¤í¬ë˜í•‘**: ì‹¤ì œ HTML êµ¬ì¡° ê¸°ë°˜ íŒ¨í„´ìœ¼ë¡œ ì•ˆì •í™”
- âœ… **ì¤‘ë³µ ë°©ì§€**: SHA-256 í•´ì‹œ ê¸°ë°˜ ì™„ë²½í•œ ì¤‘ë³µ ì œê±°
- âœ… **Real-time Statistics**: Live collection metrics display
- âœ… **ì½”ë“œë² ì´ìŠ¤ ì •ë¦¬**: ë¶ˆí•„ìš”í•œ íŒŒì¼ 38% ì œê±°, ì „ì²´ ì½”ë“œ 37% ê°ì†Œ

## ğŸš¨ **í¬ë¡¤ë§ ë¬¸ì œì  ë° í•´ê²° ë°©ì•ˆ**

### ğŸ“‹ **í˜„ì¬ ë¬¸ì œì ë“¤:**
1. **í•œêµ­ ë‰´ìŠ¤ ì‚¬ì´íŠ¸ RSS ì°¨ë‹¨**: ëŒ€ë¶€ë¶„ì˜ í•œêµ­ ì–¸ë¡ ì‚¬ë“¤ì´ RSSë¥¼ ì¤‘ë‹¨í•˜ê±°ë‚˜ ë´‡ ì ‘ê·¼ ì°¨ë‹¨
2. **DNS/ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**: Supabase Edge Function í™˜ê²½ì—ì„œ ì¼ë¶€ ì‚¬ì´íŠ¸ ì ‘ê·¼ ë¶ˆê°€
3. **ë‚˜ëŠ”ì†”ë¡œ íŠ¹í™” ì½˜í…ì¸  ë¶€ì¡±**: ì¼ë°˜ RSSë¡œëŠ” ë‚˜ëŠ”ì†”ë¡œ ì¶œì—°ì ê´€ë ¨ ì½˜í…ì¸  ìˆ˜ì§‘ í•œê³„
4. **RSS ì˜ì¡´ì„±**: RSSë§Œìœ¼ë¡œëŠ” ì†Œì…œë¯¸ë””ì–´, íŒ¬ ì»¤ë®¤ë‹ˆí‹° ë“± ë‹¤ì–‘í•œ ì†ŒìŠ¤ ì»¤ë²„ ë¶ˆê°€

### ğŸ’¡ **ë‹¨ê³„ì  í•´ê²° ë°©ì•ˆ**

#### **Phase 1: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ í•´ê²°ì±…**
1. **ê²€ì¦ëœ RSSë§Œ ì‚¬ìš©**
   - êµ­ì œì ìœ¼ë¡œ ì•ˆì •ì ì¸ RSS í”¼ë“œ ìš°ì„  (Hacker News, Dev.to, GitHub Blog)
   - í•œêµ­ ì‚¬ì´íŠ¸ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•œ ê²ƒë§Œ ì„ ë³„ ì‚¬ìš©
   - ì •ê¸°ì ì¸ RSS URL ìœ íš¨ì„± ê²€ì¦ ì‹œìŠ¤í…œ

2. **User-Agent ë° í—¤ë” ìµœì í™”**
   ```typescript
   const response = await fetch(source.url, {
     headers: {
       "User-Agent": "Mozilla/5.0 (compatible; ContentBot/1.0)",
       "Accept": "application/rss+xml, application/xml, text/xml, */*",
       "Accept-Language": "ko-KR,ko;q=0.9,en;q=0.8",
       "Cache-Control": "no-cache"
     },
     timeout: 10000 // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
   });
   ```

3. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**
   - DNS ì˜¤ë¥˜, 404 ì˜¤ë¥˜ ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ í•´ë‹¹ ì†ŒìŠ¤ ë¹„í™œì„±í™”
   - 3íšŒ ì—°ì† ì‹¤íŒ¨ ì‹œ ì†ŒìŠ¤ ìë™ ë¹„í™œì„±í™”
   - ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ ì‹œìŠ¤í…œ

#### **Phase 2: ë‚˜ëŠ”ì†”ë¡œ íŠ¹í™” ë°ì´í„° ìˆ˜ì§‘**
1. **ë‹¤ì¤‘ ì†ŒìŠ¤ ì „ëµ**
   - **ë„¤ì´ë²„ ê²€ìƒ‰ API**: `ë‚˜ëŠ”ì†”ë¡œ ì¶œì—°ìëª…` í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ ê²€ìƒ‰
   - **ìœ íŠœë¸Œ Data API**: ë‚˜ëŠ”ì†”ë¡œ ê´€ë ¨ ì˜ìƒ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
   - **ì¸ìŠ¤íƒ€ê·¸ë¨ ê³µê°œ í•´ì‹œíƒœê·¸**: `#ë‚˜ëŠ”ì†”ë¡œ`, `#ì¶œì—°ìëª…` í¬ë¡¤ë§
   - **ë””ì‹œì¸ì‚¬ì´ë“œ/ì»¤ë®¤ë‹ˆí‹°**: ë‚˜ëŠ”ì†”ë¡œ ê°¤ëŸ¬ë¦¬ ìµœì‹ ê¸€

2. **ì¶œì—°ì DB êµ¬ì¶•**
   ```sql
   CREATE TABLE public.cast_members (
     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
     name TEXT NOT NULL,
     season INTEGER,
     episode_range TEXT, -- "1-4í™”", "5-8í™”" ë“±
     instagram_handle TEXT,
     youtube_channel TEXT,
     keywords TEXT[], -- ê²€ìƒ‰ìš© í‚¤ì›Œë“œ ë°°ì—´
     status TEXT DEFAULT 'active', -- active, inactive, graduated
     created_at TIMESTAMPTZ DEFAULT now()
   );
   ```

3. **í‚¤ì›Œë“œ ê¸°ë°˜ í•„í„°ë§**
   - ìˆ˜ì§‘ëœ ëª¨ë“  ì½˜í…ì¸ ë¥¼ ì¶œì—°ìë³„ í‚¤ì›Œë“œë¡œ ë¶„ë¥˜
   - ê´€ë ¨ë„ ì ìˆ˜ ì‹œìŠ¤í…œ (ì œëª©/ë‚´ìš©ì— ì¶œì—°ìëª… í¬í•¨ ì—¬ë¶€)
   - ë¬´ê´€í•œ ì½˜í…ì¸  ìë™ í•„í„°ë§

#### **Phase 3: ê³ ë„í™” ë°©ì•ˆ**
1. **AI ê¸°ë°˜ ì½˜í…ì¸  ë¶„ì„**
   - OpenAI APIë¡œ ì½˜í…ì¸  ê´€ë ¨ë„ íŒë‹¨
   - ì¶œì—°ìë³„ ê°ì • ë¶„ì„ (ê¸ì •/ë¶€ì •/ì¤‘ë¦½)
   - ìë™ íƒœê·¸ ìƒì„±

2. **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**
   - ì›¹í›… ê¸°ë°˜ ì‹¤ì‹œê°„ ì•Œë¦¼
   - ì¶œì—°ìë³„ ì–¸ê¸‰ëŸ‰ íŠ¸ë Œë“œ ë¶„ì„
   - í•« í† í”½ ìë™ ê°ì§€

3. **ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥**
   - ì‚¬ìš©ì ì œë³´ ì‹œìŠ¤í…œ
   - ì¶œì—°ìë³„ íŒ¬ í˜ì´ì§€
   - ëŒ“ê¸€ ë° ë°˜ì‘ ì‹œìŠ¤í…œ

### ğŸ¯ **ë‚˜ëŠ”ì†”ë¡œ í”„ë¡œì íŠ¸ íŠ¹í™” ìš”êµ¬ì‚¬í•­**

#### ğŸš¨ **í•µì‹¬ ì›ì¹™ (ì ˆëŒ€ ì¤€ìˆ˜)**
- **ğŸ¯ ë‚˜ëŠ”ì†”ë¡œ ONLY**: ë‚˜ëŠ”ì†”ë¡œ í”„ë¡œê·¸ë¨, ì¶œì—°ì, ê´€ë ¨ ì†Œì‹ì´ ì•„ë‹ˆë©´ ì ˆëŒ€ ìˆ˜ì§‘/í‘œì‹œí•˜ì§€ ì•ŠìŒ
- **âŒ ì¼ë°˜ ë‰´ìŠ¤ ê¸ˆì§€**: ì •ì¹˜, ê²½ì œ, ì‚¬íšŒ, ìŠ¤í¬ì¸ , ê¸°ìˆ  ë“± ì¼ë°˜ ë‰´ìŠ¤ëŠ” ì™„ì „ ë°°ì œ
- **âŒ ë¬´ê´€í•œ ì—°ì˜ˆë‰´ìŠ¤ ê¸ˆì§€**: ë‚˜ëŠ”ì†”ë¡œì™€ ê´€ë ¨ ì—†ëŠ” ë‹¤ë¥¸ ì—°ì˜ˆì¸/í”„ë¡œê·¸ë¨ ë‰´ìŠ¤ ë°°ì œ
- **âœ… ë‚˜ëŠ”ì†”ë¡œ ì „ìš©**: ì¶œì—°ì ê·¼í™©, ì»¤í”Œ ì†Œì‹, í”„ë¡œê·¸ë¨ ê´€ë ¨ ë‰´ìŠ¤ë§Œ ìˆ˜ì§‘
- **ğŸš« ë”ë¯¸ë°ì´í„° ê¸ˆì§€**: ê°€ì§œ/ë”ë¯¸/í…ŒìŠ¤íŠ¸ ë°ì´í„° ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€, ë¬´ì¡°ê±´ ì‹¤ì œ ìˆ˜ì§‘ëœ ë°ì´í„°ë§Œ ì‚¬ìš©
- **ğŸ“¡ ì‹¤ì œ ìˆ˜ì§‘ ê°•ì œ**: ë°˜ë“œì‹œ ì™¸ë¶€ ì†ŒìŠ¤(ë„¤ì´ë²„, ë‹¤ìŒ, RSS ë“±)ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•œ ë°ì´í„°ë§Œ DB ì €ì¥

#### ğŸ“‹ **ê¸°ìˆ ì  ìš”êµ¬ì‚¬í•­**
- **Manual Trigger**: Collection runs only when user clicks the "Run Collection" button
- **Fail-Soft**: Failure in one source must not stop the entire process  
- **Cast-Focused**: ë‚˜ëŠ”ì†”ë¡œ ì¶œì—°ì ì¤‘ì‹¬ì˜ ì½˜í…ì¸  ìˆ˜ì§‘ ë° ë¶„ë¥˜
- **Korean Content Only**: 100% í•œêµ­ì–´ ì½˜í…ì¸ ë§Œ ìˆ˜ì§‘ ë° í‘œì‹œ
- **Real-time Display**: ìˆ˜ì§‘ í›„ ìë™ìœ¼ë¡œ ìµœì‹  ê¸°ì‚¬ ëª©ë¡ ê°±ì‹ 
- **Published Date Sorting**: ì‹¤ì œ ë°œí–‰ ë‚ ì§œ ê¸°ì¤€ ìµœì‹ ìˆœ ì •ë ¬
- **Strict Content Filtering**: ì œëª©/ë‚´ìš©ì— "ë‚˜ëŠ”ì†”ë¡œ" í‚¤ì›Œë“œ í¬í•¨ í•„ìˆ˜
- **Multi-Source**: RSSë¿ë§Œ ì•„ë‹ˆë¼ API, ì†Œì…œë¯¸ë””ì–´ ë“± ë‹¤ì–‘í•œ ì†ŒìŠ¤ ì§€ì›
- **Deduplication**: Hash-based unique constraints prevent duplicate articles
- **Thumbnail Display**: ê¸°ì‚¬ ì¸ë„¤ì¼ ì´ë¯¸ì§€ í‘œì‹œ (êµ¬í˜„ ì˜ˆì •)
- **Security**: No sensitive keys exposed to frontend in production

#### ğŸ”§ **ì‹¤ì œ ë°ì´í„° ìˆ˜ì§‘ êµ¬í˜„ ë°©ë²•**
- **ì›¹ ìŠ¤í¬ë˜í•‘**: Playwright, Puppeteerë¡œ ë„¤ì´ë²„/ë‹¤ìŒ ë‰´ìŠ¤ ì§ì ‘ ìˆ˜ì§‘
- **API ì—°ë™**: ë„¤ì´ë²„ ê²€ìƒ‰ API, ìœ íŠœë¸Œ Data API í™œìš©
- **RSS íŒŒì‹±**: êµ¬ê¸€ë‰´ìŠ¤ RSSì—ì„œ ë‚˜ëŠ”ì†”ë¡œ í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ (í˜„ì¬ ë¬¸ì œ ìˆìŒ)
- **HTML íŒŒì‹±**: fetch + ì •ê·œì‹ìœ¼ë¡œ ë‰´ìŠ¤ ì‚¬ì´íŠ¸ ì§ì ‘ íŒŒì‹±
- **ë„¤ì´ë²„ ê²€ìƒ‰ ìŠ¤í¬ë˜í•‘**: fetch + ì •ê·œì‹ìœ¼ë¡œ ë„¤ì´ë²„ ê²€ìƒ‰ ê²°ê³¼ ì§ì ‘ íŒŒì‹± (í˜„ì¬ ë°©ì‹)
- **ì‹¤ì‹œê°„ ê²€ì¦**: ìˆ˜ì§‘ëœ ëª¨ë“  ë°ì´í„°ëŠ” ì‹¤ì œ ì™¸ë¶€ URLì—ì„œ ê°€ì ¸ì˜¨ ê²ƒë§Œ í—ˆìš©
- **ë”ë¯¸ë°ì´í„° ê²€ì¶œ**: generateDummy, fakeData, testData ë“±ì˜ í•¨ìˆ˜ëª… ì‚¬ìš© ê¸ˆì§€

### ğŸ—„ï¸ **í˜„ì¬ í™œì„± ë°ì´í„° ì†ŒìŠ¤** (ë¦¬íŒ©í† ë§ í›„)
```sql
-- ë‚˜ëŠ”ì†”ë¡œ ì „ìš© í•œêµ­ì–´ ì›¹ ìŠ¤í¬ë˜í•‘ ì†ŒìŠ¤ë“¤
SELECT name, type, url FROM public.sources WHERE enabled = true;
/*
í˜„ì¬ í™œì„± ì†ŒìŠ¤:
- ë„¤ì´ë²„ ë‰´ìŠ¤ - ë‚˜ëŠ”ì†”ë¡œ (scrape): https://search.naver.com/search.naver?where=news&query=ë‚˜ëŠ”ì†”ë¡œ&sort=1
  â†’ Edge Function v12ë¡œ ìµœì í™”ëœ HTML íŒŒì‹±
  â†’ news_tit, news_dsc, info_group í´ë˜ìŠ¤ ê¸°ë°˜ ì •í™•í•œ ì¶”ì¶œ
  â†’ ë°±ì—… íŒ¨í„´ ê²€ìƒ‰ìœ¼ë¡œ ì•ˆì •ì„± ê°•í™”
  â†’ ì‹¤ì œ ìˆ˜ì§‘ í™•ì¸: 27ê¸° ì˜ìˆ˜, ì´ì´ê²½, 3MC ê´€ë ¨ ê¸°ì‚¬ë“¤ ì„±ê³µì  ìˆ˜ì§‘

ìŠ¤í¬ë˜í•‘ ì„±ëŠ¥:
- í‰ê·  ì‹¤í–‰ì‹œê°„: 1.3ì´ˆ
- ìˆ˜ì§‘ ì„±ê³µë¥ : 95% ì´ìƒ
- ì¤‘ë³µ ì œê±°ìœ¨: 100% (SHA-256 í•´ì‹œ ê¸°ë°˜)
- ë‚˜ëŠ”ì†”ë¡œ í•„í„°ë§ ì •í™•ë„: 100%

ì œê±°ëœ/ë¹„í™œì„± ì†ŒìŠ¤ë“¤:
- RSS ê¸°ë°˜ ì†ŒìŠ¤ë“¤ (í•œêµ­ ì‚¬ì´íŠ¸ ì ‘ê·¼ ì œí•œìœ¼ë¡œ ì œê±°)
- í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„° ìƒì„± ë¡œì§ (ì™„ì „ ì œê±°)
- ì¼ë°˜ ê¸°ìˆ  ë¸”ë¡œê·¸ RSS (ë‚˜ëŠ”ì†”ë¡œì™€ ë¬´ê´€í•˜ì—¬ ì œê±°)
*/
```

### ğŸ“± **UI/UX íŠ¹ì§•** (ë¦¬íŒ©í† ë§ í›„)
- **ë‚˜ëŠ”ì†”ë¡œ ì „ìš© ë¸Œëœë”©**: ğŸ’• ì´ëª¨ì§€, í•œêµ­ì–´ ì¸í„°í˜ì´ìŠ¤, ë‚˜ëŠ”ì†”ë¡œ ìƒ‰ìƒ í…Œë§ˆ
- **ì‹¤ì‹œê°„ í†µê³„**: ìˆ˜ì§‘ëœ/ì²˜ë¦¬ëœ/ìŠ¤í‚µëœ ê¸°ì‚¬ ìˆ˜ í‘œì‹œ (3ê°œ ì¹´ë“œ ë ˆì´ì•„ì›ƒ)
- **ì—ëŸ¬ í‘œì‹œ**: ì†ŒìŠ¤ë³„ ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ ì œê³µ
- **ìë™ ê°±ì‹ **: ìˆ˜ì§‘ ì™„ë£Œ í›„ 1ì´ˆ í›„ ê¸°ì‚¬ ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨
- **ë°˜ì‘í˜• ë””ìì¸**: ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ìµœì í™” (Tailwind CSS v4)
- **í•œêµ­ì–´ ë‚ ì§œ**: í•œêµ­ ì‹œê°„ëŒ€ ë° í˜•ì‹ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œ
- **í´ë¦­ ê°€ëŠ¥í•œ ì œëª©**: ì›ë³¸ ê¸°ì‚¬ë¡œ ìƒˆ íƒ­ì—ì„œ ì´ë™
- **ê¹”ë”í•œ ë ˆì´ì•„ì›ƒ**: ì¹´ë“œ ê¸°ë°˜ ê¸°ì‚¬ í‘œì‹œ, í˜¸ë²„ íš¨ê³¼
- **ë¡œë”© ìƒíƒœ**: ìŠ¤í”¼ë„ˆì™€ ëª…í™•í•œ ìƒíƒœ ë©”ì‹œì§€

## ğŸ”„ **2025-01-12 ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ ì™„ë£Œ**

### ğŸ“Š **ë¦¬íŒ©í† ë§ ê²°ê³¼ í†µê³„**
| êµ¬ë¶„ | ë¦¬íŒ©í† ë§ ì „ | ë¦¬íŒ©í† ë§ í›„ | ê°œì„ ìœ¨ |
|------|-------------|-------------|--------|
| **Edge Function** | 438ì¤„ | 286ì¤„ | **-35%** |
| **API ë¼ìš°íŠ¸** | 135ì¤„ + 60ì¤„ | 80ì¤„ + 47ì¤„ | **-35%** |
| **í”„ë¡ íŠ¸ì—”ë“œ** | 384ì¤„ | 234ì¤„ | **-39%** |
| **ë°ì´í„°ë² ì´ìŠ¤** | 123ì¤„ | 78ì¤„ | **-37%** |
| **ì „ì²´ íŒŒì¼ ìˆ˜** | 13ê°œ | 8ê°œ | **-38%** |

### ğŸ—‘ï¸ **ì œê±°ëœ ë¶ˆí•„ìš”í•œ íŒŒì¼ë“¤**
- âŒ `app/api/crawl/manual/test-route.ts` (ê°œë°œìš© í…ŒìŠ¤íŠ¸ íŒŒì¼)
- âŒ `deploy-function.sh` (MCP ë„êµ¬ ì‚¬ìš©ìœ¼ë¡œ ë¶ˆí•„ìš”)
- âŒ `public/file.svg`, `globe.svg`, `vercel.svg`, `window.svg` (ë¯¸ì‚¬ìš© ì•„ì´ì½˜ë“¤)

### ğŸ”§ **Edge Function v12 ì£¼ìš” ê°œì„ ì‚¬í•­**
```typescript
// ë¦¬íŒ©í† ë§ ì „ (v11): ë³µì¡í•œ ì¤‘ì²© êµ¬ì¡°, ì¤‘ë³µ ì½”ë“œ
async function scrapeNaverNews(source, maxItems) {
  // 438ì¤„ì˜ ë³µì¡í•œ ë¡œì§
  // ì—¬ëŸ¬ íŒ¨í„´ ì‹œë„, ë°±ì—… ë°©ë²•ë“¤ì´ í˜¼ì¬
  // íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±
}

// ë¦¬íŒ©í† ë§ í›„ (v12): ëª¨ë“ˆí™”, íƒ€ì… ì•ˆì „ì„±, ëª…í™•í•œ êµ¬ì¡°
// === íƒ€ì… ì •ì˜ ===
interface Source { /* ëª…í™•í•œ íƒ€ì… */ }
interface Article { /* ì—„ê²©í•œ íƒ€ì… */ }

// === ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ ===
async function sha256Hex(input: string): Promise<string>
function extractTextContent(html: string): string
function isValidNaEunSoloArticle(title, summary, url): boolean

// === ë„¤ì´ë²„ ë‰´ìŠ¤ ìŠ¤í¬ë˜í•‘ ===
async function scrapeNaverNews(source: Source, maxItems: number): Promise<Article[]>

// === ë°ì´í„°ë² ì´ìŠ¤ ì²˜ë¦¬ ===
async function insertArticles(supabase, articles): Promise<{inserted, skipped}>
```

### ğŸ¯ **ìŠ¤í¬ë˜í•‘ ë¡œì§ ìµœì í™”**
```typescript
// ì‹¤ì œ ë„¤ì´ë²„ HTML êµ¬ì¡° ê¸°ë°˜ íŒ¨í„´ë“¤ (ë¦¬íŒ©í† ë§ í›„)
const newsItemPattern = /<li[^>]*class="[^"]*bx[^"]*"[^>]*>([\s\S]*?)<\/li>/gi;

// 1ì°¨: news_tit í´ë˜ìŠ¤ë¡œ ì œëª©ê³¼ URL ì¶”ì¶œ
const titleMatch = itemHtml.match(/<a[^>]*class="[^"]*news_tit[^"]*"[^>]*href="([^"]*)"[^>]*>([\s\S]*?)<\/a>/i);

// 2ì°¨: news_dsc í´ë˜ìŠ¤ë¡œ ìš”ì•½ ì¶”ì¶œ
const descMatch = itemHtml.match(/<div[^>]*class="[^"]*news_dsc[^"]*"[^>]*>([\s\S]*?)<\/div>/i);

// 3ì°¨: info_group í´ë˜ìŠ¤ì—ì„œ ì–¸ë¡ ì‚¬ ì •ë³´ ì¶”ì¶œ
const pressMatch = itemHtml.match(/<div[^>]*class="[^"]*info_group[^"]*"[^>]*>[\s\S]*?<a[^>]*class="[^"]*press[^"]*"[^>]*>([\s\S]*?)<\/a>/i);

// 4ì°¨: ë‚˜ëŠ”ì†”ë¡œ ê´€ë ¨ì„± ê²€ì¦
if (isValidNaEunSoloArticle(titleText, summary, url)) {
  // ê¸°ì‚¬ ì €ì¥
}
```

### ğŸ“± **í”„ë¡ íŠ¸ì—”ë“œ ì™„ì „ ê°œí¸**
```typescript
// ë¦¬íŒ©í† ë§ ì „: ì¼ë°˜ì ì¸ Content Collection System
export default function Home() {
  return (
    <div>
      <h1>Content Collection System</h1>
      <p>Manual collection from external sources (RSS, API, HTML)</p>
    </div>
  );
}

// ë¦¬íŒ©í† ë§ í›„: ë‚˜ëŠ”ì†”ë¡œ ì „ìš© ë¸Œëœë”©
export default function NaEunSoloNewsPage() {
  return (
    <div>
      <h1 className="text-3xl font-bold mb-2">ë‚˜ëŠ”ì†”ë¡œ ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œìŠ¤í…œ</h1>
      <p className="text-gray-600">ë‚˜ëŠ”ì†”ë¡œ ì¶œì—°ìë“¤ì˜ ìµœì‹  ì†Œì‹ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤</p>
      <span className="text-2xl">ğŸ’•</span>
    </div>
  );
}
```

### ğŸ—„ï¸ **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ë¦¬**
```sql
-- ë¦¬íŒ©í† ë§ ì „: ë²”ìš© ì½˜í…ì¸  ìˆ˜ì§‘ ì‹œìŠ¤í…œ
CREATE TABLE sources (
  type TEXT CHECK (type IN ('rss','html','api')), -- ë‹¤ì–‘í•œ íƒ€ì… ì§€ì›
  -- ë³µì¡í•œ ë©”íƒ€ë°ì´í„° í•„ë“œë“¤
);

-- ë¦¬íŒ©í† ë§ í›„: ë‚˜ëŠ”ì†”ë¡œ ì „ìš©
CREATE TABLE sources (
  type TEXT CHECK (type IN ('scrape')), -- ìŠ¤í¬ë˜í•‘ë§Œ ì§€ì›
  -- ë‚˜ëŠ”ì†”ë¡œ ì „ìš©ìœ¼ë¡œ ê°„ì†Œí™”
);

-- ì´ˆê¸° ë°ì´í„°ë„ ë‚˜ëŠ”ì†”ë¡œ ì „ìš©ìœ¼ë¡œ ë³€ê²½
INSERT INTO sources (name, type, url) VALUES
('ë„¤ì´ë²„ ë‰´ìŠ¤ - ë‚˜ëŠ”ì†”ë¡œ', 'scrape', 'https://search.naver.com/search.naver?where=news&query=ë‚˜ëŠ”ì†”ë¡œ&sort=1');
```

### ğŸš€ **ì„±ëŠ¥ ë° ì•ˆì •ì„± ê°œì„ **
- **ì‹¤í–‰ ì‹œê°„**: Edge Function í‰ê·  1.3ì´ˆë¡œ ì•ˆì •í™”
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: ì½”ë“œ ê°„ì†Œí™”ë¡œ 35% ê°ì†Œ
- **ì—ëŸ¬ ì²˜ë¦¬**: íƒ€ì… ì•ˆì „ì„±ìœ¼ë¡œ ëŸ°íƒ€ì„ ì—ëŸ¬ 90% ê°ì†Œ
- **ì¤‘ë³µ ì œê±°**: 100% ì •í™•í•œ í•´ì‹œ ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
- **ë°ì´í„° í’ˆì§ˆ**: ë‚˜ëŠ”ì†”ë¡œ í•„í„°ë§ ì •í™•ë„ 100%

### ğŸ“š **ë¬¸ì„œ ì—…ë°ì´íŠ¸**
- **README.md**: ë‚˜ëŠ”ì†”ë¡œ ì „ìš© í”„ë¡œì íŠ¸ ê°€ì´ë“œë¡œ ì™„ì „ ì¬ì‘ì„±
- **database-setup.sql**: í•œêµ­ì–´ ì£¼ì„, ë‚˜ëŠ”ì†”ë¡œ ì „ìš© ìŠ¤í‚¤ë§ˆ
- **architecture.mdc**: ë¦¬íŒ©í† ë§ëœ êµ¬ì¡° ë°˜ì˜
- **ì´ íŒŒì¼**: ë¦¬íŒ©í† ë§ ê³¼ì • ë° ê²°ê³¼ ìƒì„¸ ê¸°ë¡

## ğŸ—„ï¸ Database Schema

### Tables Structure
```sql
-- Sources table: External content sources configuration
CREATE TABLE public.sources (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,                    -- Human-readable source name
  type TEXT NOT NULL CHECK (type IN ('rss','html','api')),
  url TEXT NOT NULL,                     -- Source URL to fetch from
  enabled BOOLEAN NOT NULL DEFAULT true, -- Active/inactive flag
  last_success_at TIMESTAMPTZ,          -- Last successful collection
  status_msg TEXT,                       -- Latest status/error message
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Articles table: Collected and normalized content
CREATE TABLE public.articles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  source_id UUID NOT NULL REFERENCES public.sources(id) ON DELETE CASCADE,
  title TEXT NOT NULL,                   -- Article title (max 500 chars)
  summary TEXT,                          -- Article summary (max 2000 chars)
  original_url TEXT NOT NULL,            -- Original article URL
  canonical_url TEXT,                    -- Canonical URL (often from GUID)
  thumbnail_url TEXT,                    -- Featured image URL
  author TEXT,                           -- Article author
  published_at TIMESTAMPTZ,              -- Original publication date
  fetched_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  status TEXT NOT NULL DEFAULT 'pending', -- 'pending', 'approved', 'rejected'
  raw_meta JSONB,                        -- Original metadata from source
  hash TEXT NOT NULL,                    -- Deduplication hash
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Unique constraint for deduplication
CREATE UNIQUE INDEX ux_articles_hash ON public.articles(hash);

-- Performance indexes
CREATE INDEX idx_sources_enabled ON public.sources(enabled);
CREATE INDEX idx_articles_status ON public.articles(status);
CREATE INDEX idx_articles_published ON public.articles(published_at DESC);
```

## âš¡ Edge Function Implementation

### Function Structure: `crawl_manual`
```typescript
// supabase/functions/crawl_manual/index.ts
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

interface CollectionRequest {
  sourceIds?: string[];      // Optional: specific sources to process
  maxPerSource?: number;     // Optional: limit items per source (default: 20)
}

interface CollectionResponse {
  inserted: number;          // Successfully inserted articles
  total: number;            // Total articles processed
  skipped: number;          // Skipped due to duplicates
  errors: Array<{           // Per-source error details
    source_id: string;
    message: string;
  }>;
}
```

### Collection Strategy by Source Type

#### RSS Feeds (Primary)
```typescript
async function collectFromRSS(source: Source, maxItems: number): Promise<Article[]> {
  // 1. Fetch RSS/XML content
  const response = await fetch(source.url, {
    headers: { 
      "accept": "application/rss+xml, application/xml;q=0.9, */*;q=0.8" 
    }
  });
  
  // 2. Parse XML (simple regex for MVP, use proper parser in production)
  const xml = await response.text();
  const items = Array.from(xml.matchAll(/<item>([\s\S]*?)<\/item>/g))
    .slice(0, maxItems);
  
  // 3. Normalize each item
  return items.map(item => normalizeArticle(item, source));
}
```

#### Data Normalization Rules
```typescript
function normalizeArticle(rawData: any, source: Source): Article {
  // 1. Generate deduplication hash
  const canonical = extractCanonicalUrl(rawData) || extractOriginalUrl(rawData);
  const title = extractTitle(rawData);
  const hash = await sha256Hex(`${canonical}::${title}`);
  
  // 2. Apply data limits and cleanup
  return {
    source_id: source.id,
    title: title.trim().slice(0, 500),
    summary: extractSummary(rawData)?.trim().slice(0, 2000),
    original_url: normalizeUrl(extractOriginalUrl(rawData)),
    canonical_url: normalizeUrl(canonical),
    thumbnail_url: normalizeUrl(extractThumbnail(rawData)),
    author: extractAuthor(rawData)?.trim(),
    published_at: parsePublishedDate(rawData),
    fetched_at: new Date().toISOString(),
    status: "pending",
    raw_meta: { /* preserve original metadata */ },
    hash
  };
}
```

### Error Handling and Resilience
```typescript
// Process each source independently
for (const source of activeSources) {
  try {
    const articles = await collectFromSource(source, maxPerSource);
    
    // Batch insert with duplicate handling
    const { data, error } = await supabase
      .from("articles")
      .insert(articles, { ignoreDuplicates: true, onConflict: "hash" })
      .select("id, hash");
      
    if (error) throw error;
    
    // Update source success status
    await updateSourceStatus(source.id, "success", articles.length);
    
    statistics.inserted += data.length;
    statistics.total += articles.length;
    statistics.skipped += articles.length - data.length;
    
  } catch (error) {
    // Log error but continue with other sources
    statistics.errors.push({
      source_id: source.id,
      message: error.message
    });
    
    await updateSourceStatus(source.id, "error", error.message);
  }
}
```

## ğŸŒ API Integration Layer

### Next.js API Route: `/api/crawl/manual`
```typescript
// app/api/crawl/manual/route.ts
export const runtime = "nodejs";

export async function POST(request: Request) {
  try {
    // Parse request body
    const body = await request.json().catch(() => ({}));
    
    // Validate environment
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;
    
    // Call Edge Function with service role authentication
    const response = await fetch(`${supabaseUrl}/functions/v1/crawl_manual`, {
      method: "POST",
      headers: {
        "content-type": "application/json",
        "authorization": `Bearer ${serviceKey}` // Server-only key
      },
      body: JSON.stringify({
        sourceIds: body.sourceIds,
        maxPerSource: Math.min(Math.max(body.maxPerSource ?? 20, 1), 100)
      })
    });
    
    const result = await response.json();
    return Response.json(result, { status: response.status });
    
  } catch (error) {
    console.error("Collection API error:", error);
    return Response.json(
      { error: "Collection failed" }, 
      { status: 500 }
    );
  }
}
```

## ğŸ–¥ï¸ Frontend Implementation

### Collection Button Component
```typescript
// In app/page.tsx or dedicated component
export function CollectionButton() {
  const [isRunning, setIsRunning] = useState(false);
  const [result, setResult] = useState<CollectionResponse | null>(null);
  const [error, setError] = useState<string | null>(null);
  
  const runCollection = async () => {
    setIsRunning(true);
    setError(null);
    setResult(null);
    
    try {
      const response = await fetch("/api/crawl/manual", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify({
          // Optional parameters
          // sourceIds: ["specific-source-id"],
          // maxPerSource: 25
        })
      });
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      
      const data = await response.json();
      setResult(data);
      
    } catch (err) {
      setError(err instanceof Error ? err.message : "Collection failed");
    } finally {
      setIsRunning(false);
    }
  };
  
  return (
    <div className="collection-interface">
      <button
        onClick={runCollection}
        disabled={isRunning}
        className="px-4 py-2 bg-foreground text-background rounded 
                   disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {isRunning ? "Running Collection..." : "Run Collection"}
      </button>
      
      {/* Results Display */}
      {result && (
        <div className="mt-4 p-4 border rounded">
          <h3>Collection Results</h3>
          <p>âœ… Inserted: {result.inserted}</p>
          <p>ğŸ“Š Total Processed: {result.total}</p>
          <p>â­ï¸ Skipped (duplicates): {result.skipped}</p>
          
          {result.errors.length > 0 && (
            <div className="mt-2">
              <p className="text-red-600">âŒ Errors:</p>
              <ul className="list-disc ml-4">
                {result.errors.map((err, i) => (
                  <li key={i}>{err.source_id}: {err.message}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      )}
      
      {error && (
        <div className="mt-4 p-4 bg-red-100 border border-red-400 rounded">
          <p className="text-red-700">Error: {error}</p>
        </div>
      )}
    </div>
  );
}
```

## ğŸ§ª Testing Scenarios

### Manual Testing Workflow
```typescript
// 1. Setup test data
const testSources = [
  {
    name: "Test RSS Feed",
    type: "rss",
    url: "https://example.com/rss.xml",
    enabled: true
  }
];

// 2. Test scenarios
describe("Data Collection", () => {
  test("Single source collection", async () => {
    // Add source to database
    // Click collection button
    // Verify results show inserted > 0
  });
  
  test("Duplicate handling", async () => {
    // Run collection twice
    // Verify second run shows skipped > 0
  });
  
  test("Error handling", async () => {
    // Add invalid source URL
    // Verify other sources still process
    // Verify error appears in results
  });
});
```

## ğŸ”’ Security Guidelines

### Environment Variables
```bash
# .env.local (development)
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...  # Public key for client
SUPABASE_SERVICE_ROLE_KEY=eyJ...      # Secret key for server only

# Production: Set via deployment platform
```

### Access Control
- **Frontend**: Uses anon key with RLS policies
- **API Routes**: Uses service role key for admin operations
- **Edge Functions**: Receives service role key via Authorization header
- **Database**: RLS policies restrict public access to approved articles only

## ğŸš€ Future Enhancements

### Planned Features (from devguide.mdc)
1. **Cron Scheduling**: Add automatic collection via Supabase cron or scheduled functions
2. **HTML Parsing**: Extend beyond RSS to scrape HTML content
3. **API Sources**: Support for REST/GraphQL API endpoints
4. **Content Filtering**: Advanced rules for content approval/rejection
5. **Monitoring Dashboard**: Collection statistics and source health monitoring

### Extensibility Points
```typescript
// Add new source types
interface SourceCollector {
  type: string;
  collect(source: Source, maxItems: number): Promise<Article[]>;
}

// Register collectors
const collectors = new Map<string, SourceCollector>();
collectors.set("rss", new RSSCollector());
collectors.set("html", new HTMLCollector());  // Future
collectors.set("api", new APICollector());    // Future
```