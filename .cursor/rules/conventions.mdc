
# ğŸ“ Coding Conventions

## ğŸ”¤ Naming Conventions

### File and Directory Names
- **Components**: PascalCase for React components (`Button.tsx`, `UserProfile.tsx`)
- **Pages**: lowercase with hyphens (`page.tsx`, `not-found.tsx`)
- **API Routes**: lowercase with hyphens (`route.ts` in nested folders)
- **Utilities**: camelCase (`supabase-browser.ts`, `data-helpers.ts`)
- **Constants**: UPPER_SNAKE_CASE (`API_ENDPOINTS.ts`)

### Variable and Function Names
```typescript
// âœ… Good
const userName = "john_doe";
const fetchUserData = async () => {};
const API_BASE_URL = "https://api.example.com";
const isLoadingState = true;

// âŒ Avoid
const user_name = "john_doe";        // snake_case for variables
const FetchUserData = async () => {}; // PascalCase for functions
const apiBaseUrl = "https://...";    // camelCase for constants
const loading = true;                // unclear boolean naming
```

### React Component Conventions
```typescript
// âœ… Component naming and structure
export default function UserDashboard() {
  const [isLoading, setIsLoading] = useState(false);
  const [userData, setUserData] = useState(null);
  
  return (
    <div className="dashboard-container">
      {/* Component content */}
    </div>
  );
}

// âœ… Custom hooks
const useUserData = (userId: string) => {
  // Hook logic
};

// âœ… Event handlers
const handleSubmit = (event: FormEvent) => {
  // Handler logic
};

const handleUserClick = (userId: string) => {
  // Handler logic
};
```

## ğŸ“ File Organization

### Import Order
```typescript
// 1. React and Next.js imports
import React, { useState, useEffect } from "react";
import Image from "next/image";
import { Metadata } from "next";

// 2. Third-party libraries
import { createClient } from "@supabase/supabase-js";

// 3. Internal utilities and configs
import { supabase } from "@/lib/supabase-browser";
import { formatDate } from "@/lib/utils";

// 4. Type imports (separate section)
import type { User, Article } from "@/types";

// 5. Relative imports
import "./component.css";
```

### Export Conventions
```typescript
// âœ… Default exports for main components
export default function HomePage() {}

// âœ… Named exports for utilities
export const formatDate = (date: Date) => {};
export const validateEmail = (email: string) => {};

// âœ… Type exports
export type { User, Article, DatabaseRow };
```

## ğŸ”§ TypeScript Conventions

### Type Definitions
```typescript
// âœ… Interface for object shapes
interface User {
  id: string;
  name: string;
  email: string;
  createdAt: Date;
}

// âœ… Type for unions and primitives
type Status = "pending" | "approved" | "rejected";
type UserId = string;

// âœ… Generic types
interface ApiResponse<T> {
  data: T;
  error?: string;
  success: boolean;
}
```

### Function Signatures
```typescript
// âœ… Explicit return types for public functions
export async function fetchUserData(userId: string): Promise<User | null> {
  // Function implementation
}

// âœ… Proper error handling
export async function saveArticle(article: Article): Promise<{
  success: boolean;
  error?: string;
  data?: Article;
}> {
  try {
    // Implementation
    return { success: true, data: savedArticle };
  } catch (error) {
    return { success: false, error: error.message };
  }
}
```

### Environment Variables
```typescript
// âœ… Type-safe environment variable access
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

// âœ… Validation in utilities
export function getEnvVar(key: string): string {
  const value = process.env[key];
  if (!value) {
    throw new Error(`Missing required environment variable: ${key}`);
  }
  return value;
}
```

## ğŸ¯ React Best Practices

### Component Structure
```typescript
// âœ… Component organization
interface Props {
  userId: string;
  onUserUpdate?: (user: User) => void;
}

export default function UserProfile({ userId, onUserUpdate }: Props) {
  // 1. State declarations
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  
  // 2. Effects
  useEffect(() => {
    fetchUser();
  }, [userId]);
  
  // 3. Event handlers
  const handleUpdate = async (userData: Partial<User>) => {
    // Handler implementation
  };
  
  // 4. Helper functions
  const fetchUser = async () => {
    // Fetch implementation
  };
  
  // 5. Early returns
  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  if (!user) return <div>User not found</div>;
  
  // 6. Main render
  return (
    <div className="user-profile">
      {/* Component JSX */}
    </div>
  );
}
```

### State Management
```typescript
// âœ… Boolean states with clear naming
const [isLoading, setIsLoading] = useState(false);
const [hasError, setHasError] = useState(false);
const [isFormValid, setIsFormValid] = useState(false);

// âœ… Object states with proper typing
const [formData, setFormData] = useState<{
  title: string;
  content: string;
  status: Status;
}>({
  title: "",
  content: "",
  status: "pending"
});

// âœ… Array states
const [articles, setArticles] = useState<Article[]>([]);
```

## ğŸŒ API and Data Handling

### API Route Structure
```typescript
// app/api/example/route.ts
export const runtime = "nodejs"; // or "edge"

export async function GET(request: Request) {
  try {
    // Implementation
    return Response.json({ success: true, data });
  } catch (error) {
    console.error("API Error:", error);
    return Response.json(
      { success: false, error: "Internal server error" },
      { status: 500 }
    );
  }
}

export async function POST(request: Request) {
  try {
    const body = await request.json();
    // Validation
    // Implementation
    return Response.json({ success: true, data });
  } catch (error) {
    return Response.json(
      { success: false, error: error.message },
      { status: 400 }
    );
  }
}
```

### Database Queries
```typescript
// âœ… Supabase query patterns
export async function fetchArticles(limit = 10): Promise<Article[]> {
  const { data, error } = await supabase
    .from("articles")
    .select("*")
    .eq("status", "approved")
    .order("published_at", { ascending: false })
    .limit(limit);
    
  if (error) throw new Error(error.message);
  return data || [];
}

// âœ… Error handling
export async function insertArticle(article: Omit<Article, "id">): Promise<Article> {
  const { data, error } = await supabase
    .from("articles")
    .insert(article)
    .select()
    .single();
    
  if (error) {
    console.error("Database insert error:", error);
    throw new Error("Failed to insert article");
  }
  
  return data;
}
```

## ğŸ“‹ Code Quality Standards

### Comments and Documentation
```typescript
/**
 * Fetches and normalizes articles from external RSS feeds
 * @param sourceId - The ID of the source to fetch from
 * @param maxItems - Maximum number of items to fetch (default: 20)
 * @returns Promise resolving to normalized articles
 */
export async function fetchFromRSS(
  sourceId: string, 
  maxItems = 20
): Promise<Article[]> {
  // Implementation with inline comments for complex logic
}

// âœ… Inline comments for business logic
const hash = await sha256Hex(`${canonical}::${title}`); // Deduplication key
```

### Error Handling Patterns
```typescript
// âœ… Consistent error handling
export async function performAction(): Promise<{
  success: boolean;
  data?: any;
  error?: string;
}> {
  try {
    const result = await someAsyncOperation();
    return { success: true, data: result };
  } catch (error) {
    console.error("Action failed:", error);
    return { 
      success: false, 
      error: error instanceof Error ? error.message : "Unknown error"
    };
  }
}
```

### Testing Considerations
```typescript
// âœ… Testable function structure
export function validateArticle(article: Partial<Article>): {
  isValid: boolean;
  errors: string[];
} {
  const errors: string[] = [];
  
  if (!article.title?.trim()) {
    errors.push("Title is required");
  }
  
  if (!article.original_url) {
    errors.push("Original URL is required");
  }
  
  return {
    isValid: errors.length === 0,
    errors
  };
}
```

## ğŸš€ Performance Guidelines

### Optimization Patterns
```typescript
// âœ… Memoization for expensive calculations
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);

// âœ… Callback memoization
const handleClick = useCallback((id: string) => {
  onItemClick(id);
}, [onItemClick]);

// âœ… Lazy loading for large components
const HeavyComponent = lazy(() => import("./HeavyComponent"));
```

### Bundle Size Considerations
```typescript
// âœ… Tree-shakable imports
import { createClient } from "@supabase/supabase-js";

// âŒ Avoid default imports for large libraries
import * as supabase from "@supabase/supabase-js";
```

## ğŸ“Š **ë‚˜ëŠ”ì†”ë¡œ ë‰´ìŠ¤ ìˆ˜ì§‘ ì„¤ì •**

í˜„ì¬ ì‹œìŠ¤í…œì€ **í•œ ë²ˆì— ìµœëŒ€ 10ê°œ**ì˜ ê¸°ì‚¬ë¥¼ ìˆ˜ì§‘í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

### ğŸ”¢ **ìˆ˜ì§‘ ê°œìˆ˜ ì„¤ì •**

1. **í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •** (`app/page.tsx`):
   ```typescript
   body: JSON.stringify({ maxPerSource: 10 })
   ```
   â†’ ì‚¬ìš©ìê°€ "ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œì‘" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ **ìµœëŒ€ 10ê°œ** ìš”ì²­

2. **Edge Function ê¸°ë³¸ê°’** (`supabase/functions/crawl_manual/index.ts`):
   ```typescript
   const { sourceIds, maxPerSource = 20 } = body;
   ```
   â†’ ìš”ì²­ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ **20ê°œ**, í•˜ì§€ë§Œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ 10ê°œë¡œ ì œí•œ

3. **ë„¤ì´ë²„ ê²€ìƒ‰ í˜ì´ì§€**:
   ```typescript
   const searchUrls = [
     'start=1',   // 1-10ë²ˆì§¸ ê¸°ì‚¬
     'start=11',  // 11-20ë²ˆì§¸ ê¸°ì‚¬  
     'start=21'   // 21-30ë²ˆì§¸ ê¸°ì‚¬
   ];
   ```
   â†’ ë„¤ì´ë²„ì—ì„œ **ìµœëŒ€ 30ê°œ ê¸°ì‚¬** ë²”ìœ„ì—ì„œ ê²€ìƒ‰í•˜ì§€ë§Œ, `maxItems`ë¡œ ì œí•œ

### ğŸ¯ **ì‹¤ì œ ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤**

1. **1í˜ì´ì§€**: ë„¤ì´ë²„ ë‰´ìŠ¤ 1-10ë²ˆì§¸ ê¸°ì‚¬ ê²€ìƒ‰
2. **í•„í„°ë§**: "ë‚˜ëŠ”ì†”ë¡œ" ê´€ë ¨ ê¸°ì‚¬ë§Œ ì„ ë³„
3. **ì œí•œ**: ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ìˆ˜ì§‘
4. **ì¤‘ë³µ ì œê±°**: ì´ë¯¸ DBì— ìˆëŠ” ê¸°ì‚¬ëŠ” ì œì™¸
5. **ìµœì¢… ê²°ê³¼**: ë³´í†µ **2-5ê°œ** ì •ë„ì˜ ìƒˆë¡œìš´ ê¸°ì‚¬ ìˆ˜ì§‘

### ğŸ’¡ **ìˆ˜ì§‘ ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ê³  ì‹¶ë‹¤ë©´?**

```typescript
// app/page.tsxì—ì„œ ìˆ˜ì •
body: JSON.stringify({ maxPerSource: 20 }) // 10 â†’ 20ìœ¼ë¡œ ë³€ê²½
```

í˜„ì¬ ì„¤ì •ì´ **10ê°œ**ì¸ ì´ìœ ëŠ” í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì—ì„œ ì ë‹¹í•œ ì–‘ìœ¼ë¡œ ì„¤ì •í•´ë‘” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë” ë§ì€ ê¸°ì‚¬ë¥¼ ì›í•˜ì‹œë©´ ì–¸ì œë“  ëŠ˜ë¦´ ìˆ˜ ìˆì–´ìš”! ğŸ“ˆ